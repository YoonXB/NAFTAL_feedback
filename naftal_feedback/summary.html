<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NAFTAL - R√©sum√© de votre enqu√™te</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="summary-container">
        <div class="summary-card">
            <div class="logo-header">
                <img src="assets/naftal-logo.webp" alt="NAFTAL Logo" class="company-logo">
                <div class="company-info">
                    <h1>NAFTAL</h1>
                    <p class="company-tagline">R√©sum√© de votre enqu√™te</p>
                </div>
            </div>
            
            <div class="summary-content">
                <div class="summary-icon">üìã</div>
                <h2>R√©sum√© de vos r√©ponses</h2>
                <p class="summary-message">
                    Veuillez v√©rifier vos r√©ponses avant de soumettre votre enqu√™te. 
                    Vous pouvez revenir en arri√®re pour modifier vos r√©ponses si n√©cessaire.
                </p>
                
                <div class="summary-sections">
                     Client Information 
                    <div class="summary-section">
                        <h3>üë§ Informations Client</h3>
                        <div class="summary-item">
                            <span class="label">Nom :</span>
                            <span class="value" id="summary-name">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">T√©l√©phone :</span>
                            <span class="value" id="summary-phone">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">Email :</span>
                            <span class="value" id="summary-email">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">Fr√©quence de visite :</span>
                            <span class="value" id="summary-frequency">-</span>
                        </div>
                    </div>
                    
                     Visit Information 
                    <div class="summary-section">
                        <h3>üìÖ Informations de Visite</h3>
                        <div class="summary-item">
                            <span class="label">Date de visite :</span>
                            <span class="value" id="summary-date">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">Heure de visite :</span>
                            <span class="value" id="summary-time">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">Services utilis√©s :</span>
                            <span class="value" id="summary-services">-</span>
                        </div>
                    </div>
                    
                     Satisfaction Ratings 
                    <div class="summary-section">
                        <h3>‚≠ê √âvaluations de Satisfaction</h3>
                        <div class="ratings-grid">
                            <div class="rating-item">
                                <span class="rating-label">Qualit√© de la station</span>
                                <span class="rating-value" id="summary-station-quality">-</span>
                            </div>
                            <div class="rating-item">
                                <span class="rating-label">Propret√© des sanitaires</span>
                                <span class="rating-value" id="summary-restroom">-</span>
                            </div>
                            <div class="rating-item">
                                <span class="rating-label">Rapidit√© du service</span>
                                <span class="rating-value" id="summary-speed">-</span>
                            </div>
                            <div class="rating-item">
                                <span class="rating-label">Amabilit√© du personnel</span>
                                <span class="rating-value" id="summary-staff">-</span>
                            </div>
                            <div class="rating-item">
                                <span class="rating-label">Disponibilit√© des produits</span>
                                <span class="rating-value" id="summary-availability">-</span>
                            </div>
                            <div class="rating-item">
                                <span class="rating-label">Perception des prix</span>
                                <span class="rating-value" id="summary-pricing">-</span>
                            </div>
                        </div>
                    </div>
                    
                     Comments and Suggestions 
                    <div class="summary-section">
                        <h3>üí¨ Commentaires et Suggestions</h3>
                        <div class="summary-item">
                            <span class="label">Probl√®me rencontr√© :</span>
                            <span class="value" id="summary-problem">-</span>
                        </div>
                        <div class="summary-item" id="problem-details-section" style="display: none;">
                            <span class="label">D√©tails du probl√®me :</span>
                            <div class="comment-box" id="summary-problem-details">-</div>
                        </div>
                        <div class="summary-item">
                            <span class="label">Suggestions :</span>
                            <div class="comment-box" id="summary-suggestions">-</div>
                        </div>
                        <div class="summary-item">
                            <span class="label">Recommandation :</span>
                            <span class="value recommendation" id="summary-recommendation">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button type="button" class="back-btn" onclick="goBackToSurvey()">
                        ‚Üê Modifier mes r√©ponses
                    </button>
                    <button type="button" class="submit-final-btn" onclick="submitFinalSurvey()">
                        Soumettre l'enqu√™te ‚úì
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function goBackToSurvey() {
            window.location.href = 'index.html';
        }
        
        function submitFinalSurvey() {
            // Get all stored data
            const clientInfo = JSON.parse(localStorage.getItem('naftal_client_info') || '{}');
            const surveyData = JSON.parse(localStorage.getItem('naftal_survey_data') || '{}');
            
            // Combine all data
            const finalData = { ...clientInfo, ...surveyData };
            
            // Create FormData object
            const formData = new FormData();
            for (const [key, value] of Object.entries(finalData)) {
                if (Array.isArray(value)) {
                    value.forEach(item => formData.append(key + '[]', item));
                } else {
                    formData.append(key, value);
                }
            }
            
            // Show loading state
            const submitBtn = document.querySelector('.submit-final-btn');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Envoi en cours...';
            submitBtn.disabled = true;
            
            // Submit to server
            fetch('submit_feedback.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Clear stored data
                    localStorage.removeItem('naftal_client_info');
                    localStorage.removeItem('naftal_survey_data');
                    // Redirect to thank you page
                    window.location.href = 'thank-you.html';
                } else {
                    alert('Une erreur est survenue. Veuillez r√©essayer.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Une erreur est survenue. Veuillez r√©essayer.');
            })
            .finally(() => {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            });
        }
        
        function getRatingEmoji(rating) {
            switch(rating) {
                case '3': return 'üòä Satisfait';
                case '2': return 'üòê Neutre';
                case '1': return '‚òπÔ∏è Insatisfait';
                default: return '-';
            }
        }
        
        function formatServices(services) {
            if (!services || services.length === 0) return '-';
            
            const serviceLabels = {
                'carburant': 'Carburant (essence/diesel)',
                'lubrifiants': 'Lubrifiants',
                'pneumatique': 'Pneumatique',
                'produits_entretiens': 'Produits entretiens',
                'station_lavage': 'Station de lavage',
                'vidange': 'Vidange',
                'vulcanisation': 'Vulcanisation',
                'boutique': 'Boutique/mini-march√©',
                'restaurant': 'Restaurant',
                'sanitaires': 'Sanitaires',
                'salle_priere': 'Salle de pri√®re'
            };
            
            return services.map(service => serviceLabels[service] || service).join(', ');
        }
        
        function formatFrequency(frequency) {
            const frequencies = {
                'premiere_fois': 'Premi√®re fois',
                'occasionnelle': 'Occasionnelle',
                'reguliere': 'R√©guli√®re',
                'quotidienne': 'Quotidienne'
            };
            return frequencies[frequency] || '-';
        }
        
        function formatRecommendation(recommendation) {
            const recommendations = {
                'oui': '‚úÖ Oui',
                'non': '‚ùå Non',
                'peut-etre': 'ü§î Peut-√™tre'
            };
            return recommendations[recommendation] || '-';
        }
        
        // Load and display summary data
        document.addEventListener('DOMContentLoaded', () => {
            const clientInfo = JSON.parse(localStorage.getItem('naftal_client_info') || '{}');
            const surveyData = JSON.parse(localStorage.getItem('naftal_survey_data') || '{}');
            
            // Client Information
            document.getElementById('summary-name').textContent = clientInfo.client_name || '-';
            document.getElementById('summary-phone').textContent = clientInfo.client_phone || '-';
            document.getElementById('summary-email').textContent = clientInfo.client_email || '-';
            document.getElementById('summary-frequency').textContent = formatFrequency(clientInfo.visit_frequency);
            
            // Visit Information
            document.getElementById('summary-date').textContent = surveyData.visit_date || '-';
            document.getElementById('summary-time').textContent = surveyData.visit_time || '-';
            document.getElementById('summary-services').textContent = formatServices(surveyData.services);
            
            // Satisfaction Ratings
            document.getElementById('summary-station-quality').textContent = getRatingEmoji(surveyData.station_quality);
            document.getElementById('summary-restroom').textContent = getRatingEmoji(surveyData.restroom_cleanliness);
            document.getElementById('summary-speed').textContent = getRatingEmoji(surveyData.service_speed);
            document.getElementById('summary-staff').textContent = getRatingEmoji(surveyData.staff_friendliness);
            document.getElementById('summary-availability').textContent = getRatingEmoji(surveyData.product_availability);
            document.getElementById('summary-pricing').textContent = getRatingEmoji(surveyData.pricing_perception);
            
            // Comments and Suggestions
            document.getElementById('summary-problem').textContent = surveyData.encountered_problem === 'oui' ? 'Oui' : 'Non';
            
            if (surveyData.encountered_problem === 'oui' && surveyData.problem_details) {
                document.getElementById('problem-details-section').style.display = 'block';
                document.getElementById('summary-problem-details').textContent = surveyData.problem_details;
            }
            
            document.getElementById('summary-suggestions').textContent = surveyData.suggestions || 'Aucune suggestion';
            document.getElementById('summary-recommendation').textContent = formatRecommendation(surveyData.recommendation);
            
            // Add entrance animation
            document.body.style.opacity = '0';
            setTimeout(() => {
                document.body.style.transition = 'opacity 0.5s ease-in-out';
                document.body.style.opacity = '1';
            }, 100);
        });
    </script>
</body>
</html>
